<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Richard Morey" />

<meta name="date" content="2014-09-12" />

<title>Embedding RData files in R Markdown files for more reproducible analyses</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>

<style type="text/css">

/* padding for bootstrap navbar */
body {
  padding-top: 50px;
  padding-bottom: 40px;
}


/* offset scroll position for anchor links (for fixed navbar)  */
.section h2 {
  padding-top: 55px;
  margin-top: -55px;
}
.section h3 {
  padding-top: 55px;
  margin-top: -55px;
}



/* don't use link color in navbar */
.dropdown-menu>li>a {
  color: black;
}

/* some padding for disqus */
#disqus_thread {
  margin-top: 45px;
}

</style>

<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/textmate.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">R Markdown v2</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="/">Home</a></li>
        <li class="dropdown">
          <a href="authoring" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Authoring <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li class="dropdown-header">R Markdown</li>
             <li><a href="authoring_basics.html">Markdown Basics</a></li>
             <li><a href="authoring_pandoc_markdown.html">Pandoc Markdown</a></li>
             <li><a href="authoring_rcodechunks.html">R Code Chunks</a></li>
             <li><a href="authoring_bibliographies_and_citations.html">Bibliographies &amp; Citations</a></li>
             <li><a href="authoring_migrating_from_v1.html">Migrating from v1</a></li>
             <li class="divider"></li>
             <li><a href="http://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf">Cheat Sheet [PDF]</a></li>
             <li><a href="http://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">Reference Guide [PDF]</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Shiny</li>
             <li><a href="authoring_shiny.html">Interactive Documents</a></li>
             <li><a href="authoring_embedded_shiny.html">Embedded Shiny Apps</a></li>
             <li><a href="authoring_shiny_widgets.html">Creating Shiny Widgets</a></li>
             <li><a href="authoring_shiny_advanced.html">Advanced Topics</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="formats" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Formats <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li class="dropdown-header">Documents</li>
             <li><a href="html_document_format.html">HTML</a></li>
             <li><a href="pdf_document_format.html">PDF</a></li>
             <li><a href="word_document_format.html">Word</a></li>
             <li><a href="odt_document_format.html">ODT</a></li>
             <li><a href="rtf_document_format.html">RTF</a></li>
             <li><a href="markdown_document_format.html">Markdown</a></li>
             <li><a href="github_document_format.html">GitHub</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Presentations</li>
             <li><a href="ioslides_presentation_format.html">ioslides</a></li>
             <li><a href="slidy_presentation_format.html">Slidy</a></li>
             <li><a href="beamer_presentation_format.html">Beamer</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Other</li>
             <li><a href="package_vignette_format.html">Package Vignette</a></li>
             <li><a href="tufte_handout_format.html">Tufte Handout</a></li>
             <li class="divider"></li>
             <li><a href="r_notebook_format.html">R Notebooks</a></li>
          </ul>
        </li>
         <li class="dropdown">
          <a href="developer" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Developer <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li><a href="developer_html_widgets.html">HTML Widgets</a></li>
             <li class="divider"></li>
             <li><a href="developer_parameterized_reports.html">Parameterized Reports</a></li>
             <li class="divider"></li>
             <li><a href="developer_document_templates.html">Document Templates</a></li>
             <li><a href="developer_custom_formats.html">Creating New Formats</a></li>
             <li class="divider"></li>
             <li><a href="https://github.com/rstudio/rmarkdown">R Markdown on GitHub</a></li>
          </ul>
        </li>
        <li><a href="articles.html">Articles</a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">
<h1 class="title">Embedding RData files in R Markdown files for more reproducible analyses</h1>
<h4 class="author"><em>Richard Morey</em></h4>
<h4 class="date"><em>September 12, 2014</em></h4>
</div>


<p><em>This article is reposted from <a href="http://bayesfactor.blogspot.com/2014/09/embedding-rdata-files-in-R%20Markdown.html">bayesfactor.blogspot.com</a> with the kind permission of Richard Morey.</em></p>
<p>For those of us interested in reproducible analysis, <a href="http://rmarkdown.rstudio.com/">R Markdown</a> is a great way of communicating our code to other researchers. <a href="http://www.rstudio.com/">RStudio</a>, in particular, makes it very easy to create attractive HTML document containing text, code, and figures, which can then be sent to colleagues or put on the internet for anyone to see. If you aren’t using R Markdown for your statistical analyses, I recommend you start; you’ll never go back to simple script files again (and your colleagues won’t want you to).</p>
<p>In this post, I describe how to improve your R Markdown by embedding data that can be downloaded by anyone viewing the document in a modern browser with javascript enabled. For a quick look, see the <a href="http://drsmorey.org/Rmarkdown/download_RData.Rmd">example Rmd file</a> and <a href="http://drsmorey.org/Rmarkdown/download_RData.html">resulting HTML file</a>.</p>
<p>One of the drawbacks of Rmakdown, from a reproducible analysis perspective, is that the data is not a part of the document itself. Typically, an R Markdown file will use R code to load a file from your disk, and when you send the resulting HTML file to a colleague, or put it on the internet, that file is separate. It must be sent in an email or placed on a server to be downloaded.</p>
<p>This raises the possibility that the data could get separated from the code, and I think this is a terrible thing for reproducible analysis. In my mind, the data and the document and data should travel together as a single document. What we would like is a method of encoding R data into the HTML file such that any user who has access to the HTML file can download it, without even having access to the internet.</p>
<p>As it turns out, files can be encoded in an HTML document via the <a href="http://en.wikipedia.org/wiki/Data_URI_scheme">URI data scheme</a>. All we need is an R function that encodes the data, and produces a link to enable downloading the data.</p>
<pre class="r"><code>setDownloadURI = function(list, filename = stop(&quot;&#39;filename&#39; must be specified&quot;), textHTML = &quot;Click here to download the data.&quot;, fileext = &quot;RData&quot;, envir = parent.frame()){
  require(base64enc,quietly = TRUE)
  divname = paste(sample(LETTERS),collapse=&quot;&quot;)
  tf = tempfile(pattern=filename, fileext = fileext)
  save(list = list, file = tf, envir = envir)
  filenameWithExt = paste(filename,fileext,sep=&quot;.&quot;)
 
  uri = dataURI(file = tf, mime = &quot;application/octet-stream&quot;, encoding = &quot;base64&quot;)
  cat(&quot;&lt;a style=&#39;text-decoration: none&#39; id=&#39;&quot;,divname,&quot;&#39;&gt;&lt;/a&gt;
    &lt;script&gt;
    var a = document.createElement(&#39;a&#39;);
    var div = document.getElementById(&#39;&quot;,divname,&quot;&#39;);
    div.appendChild(a);
    a.setAttribute(&#39;href&#39;, &#39;&quot;,uri,&quot;&#39;);
    a.innerHTML = &#39;&quot;,textHTML,&quot;&#39; + &#39; (&quot;,filenameWithExt,&quot;)&#39;;
    if (typeof a.download != &#39;undefined&#39;) {
      a.setAttribute(&#39;download&#39;, &#39;&quot;,filenameWithExt,&quot;&#39;);
    }else{
      a.setAttribute(&#39;onclick&#39;, &#39;confirm(\&quot;Your browser does not support the download HTML5 attribute. You must rename the file to &quot;,filenameWithExt,&quot; after downloading it (or use Chrome/Firefox/Opera). \&quot;)&#39;);
    }
    &lt;/script&gt;&quot;,
    sep=&quot;&quot;)
}</code></pre>
<p>The first argument of the function, list, is a character vector containing names of variables to save in the RData file.</p>
<p>Once this function is declared, all we need to do is call it in our Rmd file. If we use the argument results = ‘asis’ in our R code block, it will inject the appropriate HTML code into our compiled HTML document to allow a download of the embedded data as an RData file, and anyone with the HTML file can download it.</p>
<p>Unfortunately, blogger will not allow me to embed the data into a post; therefore, a complete, self-contained example Rmd file can be found <a href="http://drsmorey.org/Rmarkdown/download_RData.Rmd">here</a>, and the resulting HTML file can be found <a href="http://drsmorey.org/Rmarkdown/download_RData.html">here</a>.</p>
<p>Keep in mind, however, that the data file is actually embedded in the HTML file. This means that the resulting HTML file can be very large, if your data file is large. Also consider that data are encoded in base64, which increases the size of the file by about a third over the equivalent RData binary file. For very large data sets, one might consider hosting them outside of the HTML file; but for many purposes, the technique I describe will improve the ease with which you can share reproducible analyses.</p>
<p><em>Note: Richard has included a slightly cleaned up version of this functionality as <code>createDownloadURI()</code> in the <a href="https://github.com/richarddmorey/BayesFactorExtras/">BayesFactorExtras</a> package, which can be installed on github.</em></p>


<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>

<script>

// manage active state of menu based on current page
$(document).ready(function () {

    // active menu
    href = window.location.pathname
    href = href.substr(href.lastIndexOf('/') + 1)
    $('a[href="' + href + '"]').parent().addClass('active');

    // manage active menu header
    if (href.startsWith('authoring_'))
      $('a[href="' + 'authoring' + '"]').parent().addClass('active');
    else if (href.endsWith('_format.html'))
      $('a[href="' + 'formats' + '"]').parent().addClass('active');
    else if (href.startsWith('developer_'))
      $('a[href="' + 'developer' + '"]').parent().addClass('active');

});

</script>

<!-- bizible -->
<script type="text/javascript" src="//cdn.bizible.com/scripts/bizible.js" async=""></script>


<!-- disqus -->
  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rmarkdown'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>

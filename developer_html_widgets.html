<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta name="generator" content="pandoc" />



<title>HTML Widgets</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="libs/bootstrap-2.3.2/css/united.min.css" rel="stylesheet" />
<link href="libs/bootstrap-2.3.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
<script src="libs/bootstrap-2.3.2/js/bootstrap.min.js"></script>

<style type="text/css">

/* padding for bootstrap navbar */
body {
  padding-top: 50px;
  padding-bottom: 40px;
}
@media (max-width: 979px) {
  body {
    padding-top: 0;
  }
}

/* offset scroll position for anchor links (for fixed navbar)  */
@media (min-width: 980px) {
  .section h2 {
    padding-top: 52px;
    margin-top: -52px;
  }
  .section h3 {
    padding-top: 52px;
    margin-top: -52px;
  }
}


/* don't use link color in navbar */
.dropdown-menu>li>a {
  color: black;
}

</style>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/textmate.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



</head>

<body>

<div class="container">


<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="brand" href="index.html">R Markdown</a>
      <div class="nav-collapse collapse">
        <ul class="nav">
          <li><a href="index.html">Home</a></li>
          <li class="dropdown">
            <a href="authoring" class="dropdown-toggle" data-toggle="dropdown">Authoring <b class="caret"></b></a>
            <ul class="dropdown-menu">
               <li><a href="authoring_basics.html">Markdown Basics</a></li>
               <li><a href="authoring_rcodechunks.html">R Code Chunks</a></li>
               <li><a href="authoring_pandoc_markdown.html">Pandoc Markdown</a></li>
               <li class="divider"></li>
               <li><a href="authoring_compile_notebook.html">Compiling Notebooks</a></li>
               <li class="divider"></li>
               <li><a href="authoring_migrating_from_v1.html">Migrating from v1</a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="formats" class="dropdown-toggle" data-toggle="dropdown">Formats <b class="caret"></b></a>
            <ul class="dropdown-menu">
               <li class="nav-header">Documents</li>
               <li><a href="html_document_format.html">HTML</a></li>
               <li><a href="pdf_document_format.html">PDF</a></li>
               <li><a href="word_document_format.html">Word</a></li>
               <li><a href="markdown_document_format.html">Markdown</a></li>
               <li class="divider"></li>
               <li class="nav-header">Presentations</li>
               <li><a href="ioslides_presentation_format.html">ioslides</a></li>
               <li><a href="revealjs_presentation_format.html">reveal.js</a></li>
               <li><a href="beamer_presentation_format.html">Beamer</a></li>
            </ul>
          </li>
           <li class="dropdown">
            <a href="developer" class="dropdown-toggle" data-toggle="dropdown">Developer <b class="caret"></b></a>
            <ul class="dropdown-menu">
               <li><a href="developer_html_widgets.html">HTML Widgets</a></li>
               <li class="divider"></li>
               <li><a href="developer_document_templates.html">Document Templates</a></li>
               <li><a href="developer_custom_formats.html">Creating New Formats</a></li>
               <li class="divider"></li>
               <li><a href="developer_paramaterized_reports.html">Parameterized Reports</a></li>
            </ul>
          </li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>

<div class="container">
<div class="row">
<div class="span10 offset1">

<div id="header">
<h1 class="title">HTML Widgets</h1>
</div>

<div id="TOC">
<ul>
<li><a href="#creating-an-html-widget">Creating an HTML Widget</a></li>
<li><a href="#examples">Examples</a><ul>
<li><a href="#justgage">JustGage</a></li>
<li><a href="#datatables">DataTables</a></li>
</ul></li>
<li><a href="#widgets-for-existing-classes">Widgets for Existing Classes</a><ul>
<li><a href="#datatables-example-revisited">DataTables Example Revisited</a></li>
</ul></li>
</ul>
</div>

<p>HTML widgets enable you to add new types of HTML output to R Markdown documents. You might want to do this to add a binding between R and a Javascript data visualization library like <a href="http://d3js.org">d3</a> or <a href="http://leafletjs.com">Leaflet</a>. HTML widgets create output that works both inside R Markdown documents as well as while executing code from the console (e.g. to display it the RStudio Viewer).</p>
<div id="prerequisties" class="section level4">
<h4>Prerequisties</h4>
<p>Creating HTML widgets requires the development versions of both the <strong>knitr</strong> and <strong>htmltools</strong> packages. You can install them as follows:</p>
<pre class="r"><code>devtools::install_github(c(&quot;yihui/knitr&quot;, &quot;rstudio/htmltools&quot;))</code></pre>
</div>
<div id="creating-an-html-widget" class="section level2">
<h2>Creating an HTML Widget</h2>
<p>To create an HTML widget you define an R function that does the following:</p>
<ol style="list-style-type: decimal">
<li><p>Dynamically generates HTML based on it’s input parameters;</p></li>
<li><p>Enumerates the dependencies (e.g. CSS and Javascript) required by that HTML; and</p></li>
<li><p>Returns the HTML and dependencies as an object of class “html_output”</p></li>
</ol>
<p>When implementing an HTML widget you use the <code>html_dependency</code> and <code>html_output</code> functions from the <strong>htmltools</strong> package. The basic skeleton of a function that defines a new widget looks like this:</p>
<pre class="r"><code>snazzy_visualization &lt;- function(data, width, height) {
  
  # generate html for the visualization
  html &lt;- generate_snazzy_html(data, width, height)
  
  # define dependencies
  dependencies &lt;- list(
    htmltools::html_dependency(...),
    htmltools::html_dependency(...)
  )
  
  # return output
  htmltools::html_output(html, dependencies)  
}</code></pre>
<p>Dependencies are defined with a name, version, path and optional meta, script, and stylesheet elements to include within the document head (see below for examples). Multiple instances of a dependency with the same name (e.g. “jquery”) are merged into a single dependency and the most recent version specified is used.</p>
<p>It’s important to note that dependencies must be local rather than remote (i.e. they must exist on the local filesystem). This requirement exists so that HTML documents created with R Markdown can be self contained and always work offline.</p>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>Here are two examples of HTML widgets. These examples are from the <strong>rmdexamples</strong> package located at <a href="https://github.com/rstudio/rmdexamples">https://github.com/rstudio/rmdexamples</a>.</p>
<div id="justgage" class="section level3">
<h3>JustGage</h3>
<p><a href="http://justgage.com/">JustGage</a> is Javascript library used to create numeric gauge visualizations. JustGage depends on both it’s on Javascript as well as the <a href="http://raphaeljs.com/">raphael.js</a> library. Here’s what a function that defines a JustGage HTML widget might look like:</p>
<pre class="r"><code>justgage &lt;- function(title, value, min, max, 
                     label = NULL, width = 200, height = 160) {
  
  # create random/unique id to bind the div and script
  id &lt;- paste(&quot;justgage&quot;, as.integer(stats::runif(1, 1, 10000)), sep=&quot;-&quot;) 

  # create a style attribute for the width and height
  style &lt;- paste(&quot;width:&quot;, width, &quot;px;height:&quot;, height, &quot;px&quot;, sep = &quot;&quot;)
  
  # create a list representing the parameters to JustGage
  options &lt;- list(id = id,
                  title = title,
                  value = value,
                  min = min,
                  max = max,
                  label = label)

  # generate html for the justgage
  html &lt;- paste(
    &quot;&lt;div id=\&quot;&quot;, id, &quot;\&quot; &quot;,  &quot;style=\&quot;&quot;, style, &quot;\&quot;&gt;&quot;, &quot;&lt;/div&gt;&quot;, 
    &quot;&lt;script&gt;var g = new JustGage(&quot;, RJSONIO::toJSON(options), &quot;);&lt;/script&gt;&quot;,
    sep = &quot;&quot;)
  
  # define html dependencies
  dependencies &lt;- list(
    htmltools::html_dependency(
      name = &quot;raphael&quot;,
      version = &quot;2.1.2&quot;,
      path = system.file(&quot;www/libs/raphael-2.1.2&quot;, package = &quot;rmdexamples&quot;),
      script = &quot;raphael.js&quot;
    ),
    htmltools::html_dependency(
      name = &quot;justgage&quot;,
      version = &quot;1.0.1&quot;,
      path = system.file(&quot;www/libs/justgage-1.0.1&quot;, package = &quot;rmdexamples&quot;),
      script = &quot;justgage.1.0.1.min.js&quot;
    )
  )
  
  # return html output
  htmltools::html_output(html, dependencies)
}</code></pre>
<p>Note that the required Javascript libraries are contained within the function’s package (<a href="https://github.com/rstudio/rmdexamples">rmdexamples</a>) so are accessed using <code>system.file</code>.</p>
</div>
<div id="datatables" class="section level3">
<h3>DataTables</h3>
<p><a href="https://datatables.net/">DataTables</a> is a plug-in for the <a href="http://jquery.com/">jQuery</a> Javascript library that adds advanced interaction controls to any HTML table. Here’s what a function that defines a DataTables widget might look like:</p>
<pre class="r"><code>datatable &lt;- function(x, digits = getOption(&quot;digits&quot;), 
                      row.names = NA, align = NULL, ...) {
  
  # create random/unique id for the table
  id &lt;- paste(&quot;datatable&quot;, as.integer(stats::runif(1, 1, 10000)), sep=&quot;-&quot;) 
  
  # generate an html version of the table that includes the id
  html &lt;- knitr::kable(
    x, 
    format = &quot;html&quot;, 
    digits = digits,
    row.names = NA,
    align = align,
    output = FALSE,
    table.attr = paste(&quot;id=\&quot;&quot;, id, &quot;\&quot; &quot;, 
                        &quot;class=\&quot;table table-bordered\&quot; &quot;,
                        sep = &quot;&quot;),
    ...)
  
  # create the script which binds the datatable
  html &lt;- paste(html,
    &quot;&lt;script&gt;&quot;,
      &quot;$(document).ready(function() {&quot;,
        &quot;$(&#39;#&quot;, id ,&quot;&#39;).dataTable();&quot;,
      &quot;});&quot;,
   &quot;&lt;/script&gt;&quot;, sep = &quot;&quot;)
  
  # define dependencies
  dependencies &lt;- list(
    htmltools::html_dependency(
      name = &quot;jquery&quot;,
      version = &quot;1.11.0&quot;,
      path = system.file(&quot;www/libs/jquery-1.11.0&quot;, package = &quot;rmdexamples&quot;),
      script = &quot;jquery.min.js&quot;
    ),
    htmltools::html_dependency(
      name = &quot;datatables&quot;,
      version = &quot;1.9.4&quot;,
      path = system.file(&quot;www/libs/datatables-1.9.4&quot;, package = &quot;rmdexamples&quot;),
      stylesheet = &quot;css/jquery.dataTables.css&quot;,
      script = &quot;js/jquery.dataTables.min.js&quot;
    )
  )
  
  # return html output
  htmltools::html_output(html, dependencies)
}</code></pre>
<p>Note that the <code>knitr::kable</code> function is used to generate the HTML table and that the paramters to the <code>datatable</code> function are passed through to it. Note also that the required Javascript libraries are contained within the function’s package (<a href="https://github.com/rstudio/rmdexamples">rmdexamples</a>) so are accessed using <code>system.file</code>.</p>
</div>
</div>
<div id="widgets-for-existing-classes" class="section level2">
<h2>Widgets for Existing Classes</h2>
<p>Rather than creating a dedicated function to emit HTML output, it’s also possible to create custom HTML representations for existing classes (e.g. “data.frame”, “ts”, etc.). In this scenario, objects of the specified classes will be automatically printed as HTML whenever they are encountered in an R Markdown document.</p>
<p>To do this you implement the <code>knit_print</code> S3 method for the class you want to create HTML output for and return an object of type “knit_asis” that includes the requisite HTML and it’s dependencies. Here’s the general outline of what this would look like for a data frame:</p>
<pre class="r"><code>#&#39; @export
#&#39; @importFrom knitr knit_print
knit_print.data.frame &lt;- function(x) {
  
  # generate html for data.frame
  html &lt;- dataframe_html()
  
  # define dependencies
  dependencies &lt;- list(
    htmltools::html_dependency(...),
    htmltools::html_dependency(...)
  )
  
  # return knit_asis
  structure(class = &quot;knit_asis&quot;,
    html,
    knit_meta = dependencies
  )
}</code></pre>
<p>To use this binding in an R Markdown document you need to ensure that the package defining it is on the search path, for example:</p>
<pre class="r"><code>&#96;&#96;&#96;{r}
# make sure our package is on the search path
library(rmdexamples)

# now all data frames will print as a DataTable!
cars
&#96;&#96;&#96;</code></pre>


<div id="datatables-example-revisited" class="section level3">
<h3>DataTables Example Revisited</h3>
<p>If you wanted to both automatically use a DataTable for printing data frames as well as provide a dedicated function for more customized uses of DataTables you could re-write the DataTables binding as follows:</p>
<pre class="r"><code>#&#39; @export
#&#39; @importFrom knitr knit_print
knit_print.data.frame &lt;- function(x) {  
  structure(class = &quot;knit_asis&quot;,
    datatables_html(x),
    knit_meta = datatables_dependencies()
  )
}

#&#39; @export
datatable &lt;- function(x, digits = getOption(&quot;digits&quot;), 
                      row.names = NA, align = NULL, ...) {
  htmltools::html_output(
    datatables_html(x, digits, row.names, align, ...),
    datatables_dependencies()
  )
}

datatables_html &lt;- function(x, digits = getOption(&quot;digits&quot;), 
                           row.names = NA, align = NULL, ...) {
  
  # create random/unique id for the table
  id &lt;- paste(&quot;datatable&quot;, as.integer(stats::runif(1, 1, 10000)), sep=&quot;-&quot;) 
  
  # generate an html version of the table that includes the id
  html &lt;- knitr::kable(
    x, 
    format = &quot;html&quot;, 
    digits = digits,
    row.names = NA,
    align = align,
    output = FALSE,
    table.attr = paste(&quot;id=\&quot;&quot;, id, &quot;\&quot; &quot;, 
                       &quot;class=\&quot;table table-bordered\&quot; &quot;,
                       sep = &quot;&quot;),
    ...)
  
  # create the script which binds the datatable
  html &lt;- paste(html,
                &quot;&lt;script&gt;&quot;,
                &quot;$(document).ready(function() {&quot;,
                &quot;$(&#39;#&quot;, id ,&quot;&#39;).dataTable();&quot;,
                &quot;});&quot;,
                &quot;&lt;/script&gt;&quot;, sep = &quot;&quot;)
  
  html
}

datatables_dependencies &lt;- function() {
  list(
    htmltools::html_dependency(
      name = &quot;jquery&quot;,
      version = &quot;1.11.0&quot;,
      path = system.file(&quot;www/libs/jquery-1.11.0&quot;, package = &quot;rmdexamples&quot;),
      script = &quot;jquery.min.js&quot;
    ),
    htmltools::html_dependency(
      name = &quot;datatables&quot;,
      version = &quot;1.9.4&quot;,
      path = system.file(&quot;www/libs/datatables-1.9.4&quot;, package = &quot;rmdexamples&quot;),
      stylesheet = &quot;css/jquery.dataTables.css&quot;,
      script = &quot;js/jquery.dataTables.min.js&quot;
    )
  )
}</code></pre>
<p>Note that in this implementation we define functions for generating HTML and depependencies and then call them from both the implementation <code>datatable</code> and the <code>knit_print.data.frame</code> generic.</p>
<div class="references">

</div>
</div>
</div>

</div>
</div>
</div>

<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>

<script>

// manage active state of menu based on current page
$(document).ready(function () {

    // active menu
    href = window.location.pathname
    href = href.substr(href.lastIndexOf('/') + 1)
    $('a[href="' + href + '"]').parent().addClass('active');

    // manage active menu header
    if (href.startsWith('authoring_'))
      $('a[href="' + 'authoring' + '"]').parent().addClass('active');
    else if (href.endsWith('_format.html'))
      $('a[href="' + 'formats' + '"]').parent().addClass('active');
    else if (href.startsWith('developer_'))
      $('a[href="' + 'developer' + '"]').parent().addClass('active');

});

</script>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
